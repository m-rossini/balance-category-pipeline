flowchart TD
    Start([Test Suite: test_derived_features.py]) --> Fixture[comprehensive_test_data Fixture]
    
    Fixture --> |12 transactions<br/>3 years, 4 months<br/>Duplicate dates| DateTests[Date Feature Tests]
    Fixture --> RunningTests[Running Calculation Tests]
    Fixture --> IntegrityTests[Data Integrity Tests]
    Fixture --> BinningTest[Value Binning Test]
    
    DateTests --> Year[test_feature_year<br/>✓ 2022, 2023, 2024]
    DateTests --> Month[test_feature_month<br/>✓ Jan, Mar, Jun, Dec]
    DateTests --> Day[test_feature_day<br/>✓ Day extraction]
    DateTests --> DayOfWeek[test_feature_day_of_week<br/>✓ 0-6 validation]
    DateTests --> Quarter[test_feature_quarter<br/>✓ Q1-Q4]
    DateTests --> Semester[test_feature_semester<br/>✓ S1-S2]
    DateTests --> Weekend[test_feature_is_weekend<br/>✓ Fri/Sat/Sun detection]
    
    RunningTests --> OverallSum[test_feature_running_sum_overall<br/>✓ Cumulative by TxnNum]
    RunningTests --> OverallCount[test_feature_running_count_overall<br/>✓ Sequential count]
    RunningTests --> YearSum[test_feature_running_sum_year<br/>✓ Reset per year]
    RunningTests --> MonthCount[test_feature_running_count_month<br/>✓ Reset per month]
    RunningTests --> Averages[test_feature_running_average_calculations<br/>✓ All average formulas]
    
    IntegrityTests --> RowCount[test_row_count_preservation<br/>✓ CRITICAL: NO explosion<br/>input_rows == output_rows]
    IntegrityTests --> Columns[test_original_columns_preserved<br/>✓ Data unchanged]
    IntegrityTests --> Complete[test_all_expected_features_present<br/>✓ All 19 features]
    
    BinningTest --> Bins[test_feature_transaction_value_bin<br/>✓ 6 bins: 0-10 to 1500+]
    
    Year --> Pass1[✓ PASS]
    Month --> Pass2[✓ PASS]
    Day --> Pass3[✓ PASS]
    DayOfWeek --> Pass4[✓ PASS]
    Quarter --> Pass5[✓ PASS]
    Semester --> Pass6[✓ PASS]
    Weekend --> Pass7[✓ PASS]
    OverallSum --> Pass8[✓ PASS]
    OverallCount --> Pass9[✓ PASS]
    YearSum --> Pass10[✓ PASS]
    MonthCount --> Pass11[✓ PASS]
    Bins --> Pass12[✓ PASS]
    Averages --> Pass13[✓ PASS]
    RowCount --> Pass14[✓ PASS - Would catch 50,000x bug!]
    Columns --> Pass15[✓ PASS]
    Complete --> Pass16[✓ PASS]
    
    Pass1 --> Result[All 16 Tests Pass<br/>Coverage: 19/19 Features<br/>Execution: ~0.28s]
    Pass2 --> Result
    Pass3 --> Result
    Pass4 --> Result
    Pass5 --> Result
    Pass6 --> Result
    Pass7 --> Result
    Pass8 --> Result
    Pass9 --> Result
    Pass10 --> Result
    Pass11 --> Result
    Pass12 --> Result
    Pass13 --> Result
    Pass14 --> Result
    Pass15 --> Result
    Pass16 --> Result
    
    style RowCount fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#fff
    style Result fill:#51cf66,stroke:#2f9e44,stroke-width:3px,color:#000
    style Fixture fill:#748ffc,stroke:#4c6ef5,stroke-width:2px,color:#fff